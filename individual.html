<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./responsive.css">
    <script src="https://kit.fontawesome.com/d3d61f5bb0.js" crossorigin="anonymous"></script>
    <title>USA Accounting - Individual Course</title>
</head>
<body>
    <section class="form-container">
        <div class="form-box">
            <div class="heading-form">
                <h2>Please Fill Out All The Fields</h2>
            </div>
            <hr>

            <div class="form">
                <!-- Add an ID to the form -->
                <form id="enrollForm">
                    <div class="personal">
                        <h3>Personal Information</h3>
                        <label for="fullName">Full Name</label><br>
                        <input type="text" id="fullName" name="Full Name" placeholder="Full Name" required><br>
                        <label for="emailAddress">E-Mail Address</label><br>
                        <input type="email" id="emailAddress" name="E-mail Address" placeholder="E-Mail Address" required><br>
                        <label for="phoneNumber">Phone Number</label><br>
                        <input type="number" id="phoneNumber" name="Mobile Number" placeholder="Phone Number" required>
                    </div><br>
                    <div class="course-related">
                        <h3>Course Information</h3>
                        <label for="courseName">Course Name</label><br>
                        <input type="text" id="courseName" name="Course Name" value="US Individual Tax Essentials: Comprehensive Training for Individual Taxation - Learn and earn infinite LLP" disabled><br>
                        <label for="coursePrice">Price</label><br>
                        <input type="text" id="coursePrice" name="Course Price" value="11,999" disabled>
                    </div>
                    <div class="address-related">
                        <h3>Address Information</h3>
                        <label for="address">Address</label><br>
                        <input type="text" id="address" name="Address" placeholder="Full Address" required><br>
                        <label for="city">City</label><br>
                        <input type="text" id="city" name="City Name" placeholder="City Name" required><br>
                        <label for="state">State</label><br>
                        <input type="text" id="state" name="State Name" placeholder="State Name" required><br>
                        <label for="country">Country</label><br>
                        <input type="text" id="country" name="Country Name" placeholder="Country Name" required><br>
                    </div>
                    <div class="additional-related">
                        <h3>Additional Information</h3>
                        <label for="occupation">Occupation/Profession</label><br>
                        <input type="text" id="occupation" name="Occupation/Profession" placeholder="Occupation/Profession"><br>
                        <label for="purpose">Purpose Of Enrollment</label><br>
                        <input type="text" id="purpose" name="Purpose Of Enrollment" placeholder="Purpose Of Enrollment"><br>
                        <label for="referral">Referral Source</label><br>
                        <input type="text" id="referral" name="Referral Source" placeholder="From where you find us?"><br>
                    </div>

                    <div class="button-form">
                        <!-- Remove the anchor tag around the button -->
                        <button type="submit">Checkout Now&nbsp;&nbsp;<i class="fa-regular fa-credit-card"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </section>
   <!-- Firebase Compatibility Scripts -->
   <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
 
   <!-- Firebase Configuration -->
   <script src="./FirebaseConfig/firebaseconfig.js"></script>
   <script>
    firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      // If no user is authenticated, redirect to the register page
      window.location.href = 'register.html';
    }
  });
  
    // Handle form submission
    document.getElementById('enrollForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = localStorage.getItem('user');
        if (!email) {
            alert('User not logged in.');
            return;
        }

        const userData = {
            fullName: document.getElementById('fullName').value,
            email,
            phoneNumber: document.getElementById('phoneNumber').value,
            courseName: document.getElementById('courseName').value,
            coursePrice: document.getElementById('coursePrice').value,
            address: document.getElementById('address').value,
            city: document.getElementById('city').value,
            state: document.getElementById('state').value,
            country: document.getElementById('country').value,
            occupation: document.getElementById('occupation').value,
            purpose: document.getElementById('purpose').value,
            referralSource: document.getElementById('referral').value,
        };

        try {
            const db = firebase.firestore(); // Initialize Firestore
            const docRef = db.collection("enrolled_users").doc(email);

            // Check if the document already exists
            const docSnap = await docRef.get();
            if (docSnap.exists) {
                alert("You are already enrolled in this course.");
            } else {
                // Create a new document if it doesn't exist
                await docRef.set(userData);
                alert("Successfully enrolled in the course!");
            }
        } catch (error) {
            console.error("Error accessing Firestore: ", error);
            alert("An error occurred while enrolling. Please try again.");
        }
    });
</script>



 </body>
 </html>